#!/usr/bin/env python

from __future__ import print_function
import bdkd.datastore
import optparse
import sys

def main():
    usage = "usage: %prog [options] 'repository' 'resource name'"
    epilog = "Delete a Resource from a Repository."
    optparser = optparse.OptionParser(usage=usage, epilog=epilog)
    (options, args) = optparser.parse_args()

    if len(args) < 2:
        optparser.error("Need to provide a repository and a resource name")

    # Repository
    repository_name = args.pop(0)
    repository = bdkd.datastore.repository(repository_name)
    if not repository:
        optparser.error("The repository '{0}' is not valid or not configured"
                .format(repository_name))

    # Resource
    resource_name = args.pop(0)
    resource = repository.get(resource_name)
    if resource:
        repository.delete(resource)
    else:
        print("Resource '{0}' in '{1}' does not exist"
                .format(resource_name, repository_name),
                file=sys.stderr)
        sys.exit(1)

if __name__ == "__main__":
    main()
